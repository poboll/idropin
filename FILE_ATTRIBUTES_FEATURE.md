# 文件属性管理功能实现完成

## 功能概述

在任务管理的"更多设置"对话框中添加了"文件属性管理"标签页，允许用户配置文件上传的限制条件。

## 实现的功能

### 1. 文件类型限制
- **不限制文件类型**：允许上传任何类型的文件
- **限制文件类型**：通过文件扩展名限制（不区分大小写）
  - 示例：`txt,png,jpeg,webp,pdf,doc,docx`
  - 用逗号分隔多个文件类型
  - 自动转换为小写进行匹配

### 2. 最大文件数量
- 设置用户一次最多可以提交多少个文件
- 范围：1-16 个文件
- 默认值：10 个文件
- 提供滑块和数字输入框两种方式调整

### 3. 单个文件最大大小
- 设置单个文件的最大大小（以字节为单位）
- 0 表示不限制文件大小
- 提供单位换算参考：
  - 1 KB = 1,024 字节
  - 1 MB = 1,024 KB
  - 1 GB = 1,024 MB
- 常用值示例：
  - 10 MB = 10,485,760 字节
  - 100 MB = 104,857,600 字节

### 4. 实时预览
在设置页面底部显示当前配置的预览：
- 文件类型限制状态
- 最多提交文件数量
- 文件大小限制（自动转换为 MB 显示）

## 技术实现

### 后端更改

1. **数据库迁移** (`V7__add_max_file_count.sql`)
   - 添加 `max_file_count` 字段到 `collection_task` 表
   - 默认值：10

2. **实体类更新** (`CollectionTask.java`)
   - 添加 `maxFileCount` 字段

3. **DTO更新** (`CreateTaskRequest.java`)
   - 添加 `maxFileCount` 字段

4. **Service层** (`CollectionTaskServiceImpl.java`)
   - `createTask`: 设置默认 `maxFileCount` 为 10
   - `updateTask`: 支持更新 `maxFileCount`

5. **Mapper更新** (`CollectionTaskMapper.xml`)
   - 在所有查询和插入语句中添加 `max_file_count` 字段

### 前端更改

1. **API类型定义** (`tasks.ts`)
   - `CreateTaskRequest` 和 `CollectionTask` 接口添加 `maxFileCount` 字段

2. **MoreSettingsDialog组件** (`MoreSettingsDialog.tsx`)
   - 添加新的标签页："文件属性管理"
   - 添加状态管理：
     - `fileTypeRestriction`: 'none' | 'restricted'
     - `allowedFileTypes`: string (逗号分隔的文件扩展名)
     - `maxFileCount`: number (1-16)
     - `maxFileSizeValue`: number (字节)
   - 在 `loadInfo` 中加载现有的文件属性设置
   - 在 `handleSave` 中保存文件属性设置
   - UI组件：
     - 文件类型限制切换按钮
     - 文件扩展名输入框
     - 文件数量滑块和数字输入
     - 文件大小输入框（带单位换算说明）
     - 当前设置预览卡片

3. **管理界面修复** (`manage/layout.tsx`)
   - 添加 `mounted` 状态管理，防止 hydration 错误
   - 改进权限检查逻辑
   - 添加加载状态显示

## 测试结果

✅ 后端API测试通过：
- 创建任务时设置文件属性
- 更新任务文件属性
- 获取任务详情返回正确的文件属性

✅ 前端编译成功，无TypeScript错误

✅ 数据库字段添加成功

## 使用方法

1. 登录系统，进入任务管理页面
2. 选择一个任务，点击"更多设置"
3. 切换到"文件属性管理"标签页
4. 配置文件限制：
   - 选择是否限制文件类型
   - 如果限制，输入允许的文件扩展名（逗号分隔）
   - 调整最大文件数量（1-16）
   - 设置单个文件最大大小（字节，0=不限制）
5. 查看底部的预览确认设置
6. 点击"保存设置"

## 注意事项

- 文件类型通过扩展名匹配，不区分大小写
- 文件大小以字节为单位存储，前端显示时会转换为 MB
- 最大文件数量范围限制在 1-16 之间
- 设置为 0 的文件大小表示不限制

## 后续优化建议

1. 在提交页面应用文件属性限制验证
2. 添加文件类型的预设模板（如：图片、文档、视频等）
3. 文件大小输入支持单位选择（B/KB/MB/GB）
4. 添加批量设置功能（应用到多个任务）

## 提交信息

Commit: ab8a823
提交时间: 2026-01-30
提交描述: 添加文件属性管理功能和收集类型选项
