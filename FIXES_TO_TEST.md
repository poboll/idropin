# 待测试修复清单

## 已修复的问题

### 1. ✅ Next.js 图片配置
- **问题**：pic.imgdb.cn 域名未配置
- **修复**：已添加到 next.config.js
- **状态**：需要硬刷新浏览器 (Cmd+Shift+R)

### 2. ✅ 必填信息显示 undefined
- **问题**：InfosForm 显示 "请输入 undefined"
- **修复**：添加默认值处理
  - `info.text || '未命名字段'`
  - `info.text || '内容'`
  - `info.text || '选项'`
- **测试**：访问任务提交页面，检查字段名称

### 3. ✅ 分享按钮自动复制链接
- **问题**：点击分享按钮跳转到分享页面
- **修复**：改为自动复制链接到剪贴板
- **效果**：右上角显示绿色提示 "已复制分享链接到剪贴板"
- **测试**：
  1. 进入任务列表
  2. 点击任务卡片的"..."按钮
  3. 点击"分享"
  4. 检查是否显示绿色提示
  5. 粘贴测试链接是否正确

### 4. ⚠️ 批注信息不显示
- **问题**：批注文字和图片都不显示
- **可能原因**：
  1. 后端 API 返回的数据为空
  2. `taskMoreInfo.tip` 字段为 null 或空字符串
  3. JSON 解析失败
- **需要检查**：
  ```bash
  # 测试后端API
  curl -X GET "http://localhost:8081/api/tasks/{taskKey}/more-info"
  ```
- **预期返回**：
  ```json
  {
    "tip": "{\"text\":\"批注文字\",\"imgs\":[{\"uid\":1,\"name\":\"图片URL\"}]}"
  }
  ```

## 测试步骤

### 测试 1：图片加载
1. 硬刷新浏览器 (Cmd+Shift+R 或 Ctrl+Shift+R)
2. 访问：http://localhost:5224/task/cd57f26d-bee8-40f0-8064-9385e30a0eff
3. 检查 logo 是否正常显示
4. 打开浏览器控制台，检查是否还有图片错误

### 测试 2：必填信息
1. 访问任务提交页面
2. 检查"必要信息填写"区域
3. 确认字段名称不是 "undefined"
4. 应该显示实际字段名或"未命名字段"

### 测试 3：分享功能
1. 访问：http://localhost:5224/dashboard/tasks
2. 找到任意任务卡片
3. 点击右下角的"..."按钮
4. 点击"分享"选项
5. 检查：
   - [ ] 右上角出现绿色提示框
   - [ ] 提示内容："已复制分享链接到剪贴板"
   - [ ] 提示框3秒后自动消失
   - [ ] 粘贴链接格式正确：`http://localhost:5224/task/{taskId}`

### 测试 4：批注信息（需要后端数据）
1. 在任务管理中配置批注信息：
   - 添加批注文字
   - 上传批注图片（最多3张）
2. 保存后访问任务提交页面
3. 检查：
   - [ ] "注意事项"区域显示
   - [ ] 批注文字正确显示
   - [ ] 批注图片正确显示
   - [ ] 图片可以点击查看大图

## 调试批注信息

如果批注信息不显示，请执行以下调试：

### 1. 检查后端API
```bash
# 获取任务更多信息
curl -X GET "http://localhost:8081/api/tasks/cd57f26d-bee8-40f0-8064-9385e30a0eff/more-info" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. 检查返回数据
```json
{
  "data": {
    "tip": "{\"text\":\"这是批注文字\",\"imgs\":[{\"uid\":1,\"name\":\"https://example.com/image.jpg\"}]}",
    "info": "姓名\n学号",
    "bindField": "姓名",
    // ...
  }
}
```

### 3. 检查前端解析
打开浏览器控制台，在任务提交页面执行：
```javascript
// 检查 tipData 状态
console.log('tipData:', tipData);

// 检查 taskMoreInfo
console.log('taskMoreInfo:', taskMoreInfo);
```

### 4. 常见问题
- **tip 为 null**：后端没有保存批注信息
- **tip 为空字符串**：批注信息被清空
- **JSON 解析失败**：tip 格式不正确
- **imgs 数组为空**：没有上传图片

## 如果批注信息确实为空

需要在任务管理中重新配置：

1. 登录系统
2. 进入任务管理
3. 点击任务的"更多设置"
4. 在"批注信息"标签页：
   - 输入批注文字
   - 上传批注图片
5. 点击保存
6. 刷新任务提交页面测试

## 提交状态

- ✅ 代码已提交到本地 git
- ❌ **未推送到 GitHub**
- ⏳ 等待测试确认

## 推送前检查清单

- [ ] 图片加载正常
- [ ] 必填信息显示正常
- [ ] 分享功能工作正常
- [ ] 批注信息显示正常（如果有数据）
- [ ] 浏览器控制台无错误
- [ ] 所有功能测试通过

**确认所有测试通过后，再执行推送：**
```bash
git push origin main
```

---

**创建时间**：2026-01-27
**状态**：等待测试
