# Idrop.in - äº‘é›† | éƒ¨ç½²æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
2. [æœ¬åœ°å¼€å‘éƒ¨ç½²](#æœ¬åœ°å¼€å‘éƒ¨ç½²)
3. [Dockerå®¹å™¨éƒ¨ç½²](#dockerå®¹å™¨éƒ¨ç½²)
4. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
5. [ç›‘æ§ä¸ç»´æŠ¤](#ç›‘æ§ä¸ç»´æŠ¤)
6. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç³»ç»Ÿè¦æ±‚

### å¼€å‘ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Linux / macOS / Windows
- **Java**: JDK 17+
- **Node.js**: 18+
- **PostgreSQL**: 16+
- **Redis**: 7+
- **MinIO**: Latest

### ç”Ÿäº§ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+ æˆ– CentOS 8+)
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **å†…å­˜**: æœ€å°‘ 4GB
- **ç£ç›˜**: æœ€å°‘ 50GB

---

## æœ¬åœ°å¼€å‘éƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/idropin.git
cd idropin
```

### 2. å¯åŠ¨ä¾èµ–æœåŠ¡

```bash
# ä½¿ç”¨Docker Composeå¯åŠ¨PostgreSQLã€Redisã€MinIO
docker-compose up -d postgres redis minio
```

### 3. åç«¯å¯åŠ¨

```bash
cd idropin-backend

# é…ç½®application.yml
# ç¼–è¾‘ src/main/resources/application.yml

# æ„å»ºé¡¹ç›®
mvn clean package

# å¯åŠ¨åº”ç”¨
mvn spring-boot:run
```

### 4. å‰ç«¯å¯åŠ¨

```bash
cd idropin-frontend

# å®‰è£…ä¾èµ–
npm install

# åˆ›å»º.env.local
echo "NEXT_PUBLIC_API_URL=http://localhost:8080/api" > .env.local

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### 5. è®¿é—®åº”ç”¨

- å‰ç«¯: http://localhost:3000
- åç«¯API: http://localhost:8080/api
- APIæ–‡æ¡£: http://localhost:8080/swagger-ui.html
- MinIOæ§åˆ¶å°: http://localhost:9001

---

## Dockerå®¹å™¨éƒ¨ç½²

### 1. ä½¿ç”¨Docker Composeä¸€é”®éƒ¨ç½²

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# æ¸…ç†æ‰€æœ‰æ•°æ®
docker-compose down -v
```

### 2. å•ç‹¬æ„å»ºé•œåƒ

```bash
# æ„å»ºåç«¯é•œåƒ
cd idropin-backend
docker build -t idropin-backend:latest .

# æ„å»ºå‰ç«¯é•œåƒ
cd idropin-frontend
docker build -t idropin-frontend:latest .

# è¿è¡Œåç«¯å®¹å™¨
docker run -d \
  --name idropin-backend \
  -p 8080:8080 \
  -e SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/idropin \
  -e SPRING_DATASOURCE_USERNAME=idropin \
  -e SPRING_DATASOURCE_PASSWORD=idropin123 \
  -e SPRING_REDIS_HOST=redis \
  -e MINIO_ENDPOINT=http://minio:9000 \
  idropin-backend:latest

# è¿è¡Œå‰ç«¯å®¹å™¨
docker run -d \
  --name idropin-frontend \
  -p 3000:3000 \
  -e NEXT_PUBLIC_API_URL=http://localhost:8080/api \
  idropin-frontend:latest
```

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. æœåŠ¡å™¨å‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»º.envæ–‡ä»¶
cat > .env << EOF
# PostgreSQL
POSTGRES_DB=idropin
POSTGRES_USER=idropin
POSTGRES_PASSWORD=$(openssl rand -base64 32)

# Redis
REDIS_PASSWORD=$(openssl rand -base64 32)

# MinIO
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=$(openssl rand -base64 32)

# JWT
JWT_SECRET=$(openssl rand -base64 64)
JWT_EXPIRATION=86400000

# API
API_URL=https://api.yourdomain.com
FRONTEND_URL=https://yourdomain.com
EOF
```

### 3. é…ç½®Nginxåå‘ä»£ç†

```nginx
# /etc/nginx/sites-available/idropin
upstream backend {
    server backend:8080;
}

upstream frontend {
    server frontend:3000;
}

server {
    listen 80;
    server_name yourdomain.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;

    # å®‰å…¨å¤´
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # å‰ç«¯
    location / {
        proxy_pass http://frontend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # åç«¯API
    location /api/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocketæ”¯æŒ
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### 4. å¯åŠ¨åº”ç”¨

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f frontend
```

### 5. SSLè¯ä¹¦é…ç½®

```bash
# ä½¿ç”¨Let's Encryptè·å–å…è´¹è¯ä¹¦
sudo apt install certbot python3-certbot-nginx -y

# è·å–è¯ä¹¦
sudo certbot certonly --nginx -d yourdomain.com

# è‡ªåŠ¨ç»­æœŸ
sudo systemctl enable certbot.timer
sudo systemctl start certbot.timer
```

---

## ç›‘æ§ä¸ç»´æŠ¤

### 1. æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f frontend

# å¯¼å‡ºæ—¥å¿—
docker-compose logs > logs.txt
```

### 2. æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½PostgreSQL
docker exec idropin-postgres pg_dump -U idropin idropin > backup.sql

# å¤‡ä»½MinIOæ•°æ®
docker exec idropin-minio mc mirror minio/idropin ./backup/minio

# å¤‡ä»½Redis
docker exec idropin-redis redis-cli BGSAVE
docker cp idropin-redis:/data/dump.rdb ./backup/
```

### 3. æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

### 4. å®šæœŸç»´æŠ¤

```bash
# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒå’Œå®¹å™¨
docker system prune -a

# æ›´æ–°é•œåƒ
docker-compose pull
docker-compose up -d

# æ£€æŸ¥æ•°æ®åº“
docker exec idropin-postgres psql -U idropin -d idropin -c "SELECT version();"
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥PostgreSQLæœåŠ¡
docker-compose ps postgres

# æŸ¥çœ‹PostgreSQLæ—¥å¿—
docker-compose logs postgres

# é‡å¯PostgreSQL
docker-compose restart postgres
```

### é—®é¢˜2ï¼šRedisè¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥RedisæœåŠ¡
docker-compose ps redis

# æµ‹è¯•Redisè¿æ¥
docker exec idropin-redis redis-cli ping

# é‡å¯Redis
docker-compose restart redis
```

### é—®é¢˜3ï¼šMinIOè¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥MinIOæœåŠ¡
docker-compose ps minio

# æŸ¥çœ‹MinIOæ—¥å¿—
docker-compose logs minio

# é‡å¯MinIO
docker-compose restart minio
```

### é—®é¢˜4ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯

```bash
# æ£€æŸ¥åç«¯æœåŠ¡
docker-compose ps backend

# æµ‹è¯•åç«¯è¿æ¥
curl http://localhost:8080/api/health

# æ£€æŸ¥ç½‘ç»œ
docker network ls
docker network inspect idropin-network
```

### é—®é¢˜5ï¼šç£ç›˜ç©ºé—´ä¸è¶³

```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
du -sh *

# æ¸…ç†Dockeræ•°æ®
docker system prune -a --volumes

# æ¸…ç†æ—¥å¿—
docker exec idropin-backend truncate -s 0 /var/log/app.log
```

---

## å¸¸ç”¨å‘½ä»¤

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# è¿›å…¥å®¹å™¨
docker exec -it idropin-backend bash

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æ¸…ç†ç³»ç»Ÿ
docker system prune -a
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - å®šæœŸåˆ†æå’Œä¼˜åŒ–æŸ¥è¯¢
   - åˆ›å»ºé€‚å½“çš„ç´¢å¼•
   - å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

2. **ç¼“å­˜ä¼˜åŒ–**
   - ä½¿ç”¨Redisç¼“å­˜çƒ­æ•°æ®
   - è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
   - ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡

3. **å­˜å‚¨ä¼˜åŒ–**
   - å®šæœŸæ¸…ç†è¿‡æœŸæ–‡ä»¶
   - ä½¿ç”¨åˆ†å±‚å­˜å‚¨ç­–ç•¥
   - ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨

4. **åº”ç”¨ä¼˜åŒ–**
   - å¯ç”¨GZIPå‹ç¼©
   - ä½¿ç”¨CDNåŠ é€Ÿ
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

---

## å®‰å…¨å»ºè®®

1. **ç½‘ç»œå®‰å…¨**
   - ä½¿ç”¨HTTPS/TLSåŠ å¯†
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - é™åˆ¶APIè®¿é—®é€Ÿç‡

2. **æ•°æ®å®‰å…¨**
   - å®šæœŸå¤‡ä»½æ•°æ®
   - åŠ å¯†æ•æ„Ÿæ•°æ®
   - ä½¿ç”¨å¼ºå¯†ç 

3. **åº”ç”¨å®‰å…¨**
   - å®šæœŸæ›´æ–°ä¾èµ–
   - è¿›è¡Œå®‰å…¨å®¡è®¡
   - ç›‘æ§å¼‚å¸¸æ´»åŠ¨

---

*æ–‡æ¡£æŒç»­æ›´æ–°ä¸­...*
