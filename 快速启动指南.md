# Idrop.in - äº‘é›† | å¿«é€Ÿå¯åŠ¨æŒ‡å—

> æ›´æ–°æ—¶é—´: 2024å¹´12æœˆ28æ—¥

## ğŸ“‹ å‰ç½®æ¡ä»¶

### å¿…éœ€è½¯ä»¶
- [x] Java 17+ (æ¨èä½¿ç”¨ JDK 17)
- [x] Node.js 18+
- [x] PostgreSQL 16+
- [x] Redis 7+
- [x] Maven 3.8+ (æˆ–ä½¿ç”¨ IDEA å†…ç½® Maven)

### å¯é€‰è½¯ä»¶
- [ ] MinIO (æ–‡ä»¶å­˜å‚¨ï¼Œåç»­åŠŸèƒ½éœ€è¦)
- [ ] Docker (å®¹å™¨åŒ–éƒ¨ç½²)

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### ç¬¬1æ­¥ï¼šæ•°æ®åº“å‡†å¤‡

```sql
-- è¿æ¥ PostgreSQL
psql -U postgres

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE idropin;

-- åˆ‡æ¢åˆ°æ•°æ®åº“
\c idropin

-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE sys_user (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(500),
    status VARCHAR(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_user_username ON sys_user(username);
CREATE INDEX idx_user_email ON sys_user(email);
```

### ç¬¬2æ­¥ï¼šé…ç½®åç«¯

ç¼–è¾‘ `idropin-backend/src/main/resources/application.yml`:

```yaml
server:
  port: 8080
  servlet:
    context-path: /api

spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/idropin
    username: root      # ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“ç”¨æˆ·å
    password: root      # ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“å¯†ç 
    driver-class-name: org.postgresql.Driver

  data:
    redis:
      host: localhost
      port: 6379

jwt:
  secret: ThisIsAVeryLongSecretKeyForIdropinProjectMustBeAtLeast64BytesLongForHS512Algorithm
  expiration: 86400000  # 24å°æ—¶
```

### ç¬¬3æ­¥ï¼šå¯åŠ¨åç«¯

```bash
# è¿›å…¥åç«¯ç›®å½•
cd idropin-backend

# æ–¹å¼1: ä½¿ç”¨ç³»ç»Ÿ Maven
mvn spring-boot:run

# æ–¹å¼2: ä½¿ç”¨æŒ‡å®šè·¯å¾„çš„ Maven (ä½ çš„ç¯å¢ƒ)
/Users/Apple/environment/apache-maven-3.9.5/bin/mvn spring-boot:run

# æ–¹å¼3: åœ¨ IDEA ä¸­ç›´æ¥è¿è¡Œ
# æ‰“å¼€ IdropinBackendApplication.javaï¼Œç‚¹å‡»è¿è¡ŒæŒ‰é’®
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**:
```
Started IdropinBackendApplication in X.XXX seconds
```

**è®¿é—®åœ°å€**:
- API: http://localhost:8080/api
- APIæ–‡æ¡£: http://localhost:8080/api/doc.html

### ç¬¬4æ­¥ï¼šé…ç½®å‰ç«¯

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd idropin-frontend

# åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
echo "NEXT_PUBLIC_API_URL=http://localhost:8080/api" > .env.local
```

### ç¬¬5æ­¥ï¼šå¯åŠ¨å‰ç«¯

```bash
# å®‰è£…ä¾èµ– (é¦–æ¬¡è¿è¡Œ)
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**:
```
â–² Next.js 14.0.4
- Local: http://localhost:3000
âœ“ Ready
```

**è®¿é—®åœ°å€**: http://localhost:3000

---

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### 1. ç”¨æˆ·æ³¨å†Œ

1. è®¿é—® http://localhost:3000/register
2. å¡«å†™ä¿¡æ¯:
   - ç”¨æˆ·å: `testuser` (3-50å­—ç¬¦)
   - é‚®ç®±: `test@example.com`
   - å¯†ç : `123456` (è‡³å°‘6ä½)
   - ç¡®è®¤å¯†ç : `123456`
3. ç‚¹å‡»"æ³¨å†Œ"
4. æˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

### 2. ç”¨æˆ·ç™»å½•

1. è®¿é—® http://localhost:3000/login
2. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
3. ç‚¹å‡»"ç™»å½•"
4. æˆåŠŸåè·³è½¬åˆ° Dashboard

### 3. Dashboard

- æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯
- ç‚¹å‡»"ç™»å‡º"é€€å‡ºç™»å½•

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

### å±æ€§æµ‹è¯• (Property-Based Testing)

```bash
cd idropin-backend

# è¿è¡Œæ‰€æœ‰å±æ€§æµ‹è¯•
/Users/Apple/environment/apache-maven-3.9.5/bin/mvn test -Dtest=AuthServicePropertyTest,UserServicePropertyTest,JwtTokenPropertyTest

# å•ç‹¬è¿è¡Œ
/Users/Apple/environment/apache-maven-3.9.5/bin/mvn test -Dtest=AuthServicePropertyTest
/Users/Apple/environment/apache-maven-3.9.5/bin/mvn test -Dtest=UserServicePropertyTest
/Users/Apple/environment/apache-maven-3.9.5/bin/mvn test -Dtest=JwtTokenPropertyTest
```

### æµ‹è¯•è¦†ç›–çš„å±æ€§

| æµ‹è¯•ç±» | å±æ€§ | è¯´æ˜ |
|--------|------|------|
| AuthServicePropertyTest | Property 1 | æœ‰æ•ˆæ³¨å†Œåˆ›å»ºç”¨æˆ· |
| AuthServicePropertyTest | Property 2 | é‡å¤ç”¨æˆ·åæ‹’ç» |
| AuthServicePropertyTest | Property 5 | å¯†ç BCryptåŠ å¯† |
| AuthServicePropertyTest | Property 6 | æœ‰æ•ˆç™»å½•è¿”å›JWT |
| AuthServicePropertyTest | Property 7 | æ— æ•ˆå¯†ç æ‹’ç» |
| UserServicePropertyTest | Property 11 | ç”¨æˆ·ä¿¡æ¯å“åº”ç»“æ„ |
| UserServicePropertyTest | Property 12 | æ­£ç¡®æ—§å¯†ç ä¿®æ”¹æˆåŠŸ |
| UserServicePropertyTest | Property 13 | é”™è¯¯æ—§å¯†ç ä¿®æ”¹å¤±è´¥ |
| JwtTokenPropertyTest | Property 6 | Tokenç”Ÿæˆæœ‰æ•ˆ |
| JwtTokenPropertyTest | Property 8 | Token Round-Trip |

---

## ğŸ“Š API æ¥å£

### è®¤è¯æ¥å£

#### æ³¨å†Œ
```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "email": "test@example.com",
    "password": "123456"
  }'
```

#### ç™»å½•
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456"
  }'
```

### ç”¨æˆ·æ¥å£

#### è·å–å½“å‰ç”¨æˆ·
```bash
curl -X GET http://localhost:8080/api/user/me \
  -H "Authorization: Bearer <your_token>"
```

#### ä¿®æ”¹å¯†ç 
```bash
curl -X PUT http://localhost:8080/api/user/password \
  -H "Authorization: Bearer <your_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "oldPassword": "123456",
    "newPassword": "654321"
  }'
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: åç«¯å¯åŠ¨æŠ¥æ•°æ®åº“è¿æ¥é”™è¯¯
**A**: 
1. æ£€æŸ¥ PostgreSQL æ˜¯å¦å¯åŠ¨: `pg_isready`
2. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨: `psql -U postgres -c "\l"`
3. æ£€æŸ¥ç”¨æˆ·åå¯†ç æ˜¯å¦æ­£ç¡®

### Q: å‰ç«¯æŠ¥ CORS é”™è¯¯
**A**: ç¡®ä¿åç«¯ `SecurityConfig.java` ä¸­å·²é…ç½® CORS:
```java
.cors(cors -> cors.configurationSource(corsConfigurationSource()))
```

### Q: JWT Token éªŒè¯å¤±è´¥
**A**: 
1. æ£€æŸ¥ `jwt.secret` æ˜¯å¦è¶³å¤Ÿé•¿ï¼ˆè‡³å°‘64å­—èŠ‚ï¼‰
2. æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ
3. æ£€æŸ¥ Authorization header æ ¼å¼: `Bearer <token>`

### Q: å‰ç«¯é¡µé¢ç©ºç™½
**A**:
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. ç¡®ä¿ `.env.local` é…ç½®æ­£ç¡®
3. é‡å¯å‰ç«¯æœåŠ¡: `npm run dev`

### Q: Maven å‘½ä»¤æ‰¾ä¸åˆ°
**A**: ä½¿ç”¨å®Œæ•´è·¯å¾„:
```bash
/Users/Apple/environment/apache-maven-3.9.5/bin/mvn <command>
```

---

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
idrop-in/
â”œâ”€â”€ idropin-backend/                    # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/main/java/com/idropin/
â”‚   â”‚   â”œâ”€â”€ application/service/        # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ domain/                     # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ infrastructure/             # åŸºç¡€è®¾æ–½
â”‚   â”‚   â””â”€â”€ interfaces/rest/            # RESTæ§åˆ¶å™¨
â”‚   â””â”€â”€ src/test/java/                  # æµ‹è¯•ä»£ç 
â”‚
â”œâ”€â”€ idropin-frontend/                   # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ lib/api/                        # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ lib/stores/                     # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ components/auth/                # è®¤è¯ç»„ä»¶
â”‚   â””â”€â”€ src/app/                        # é¡µé¢è·¯ç”±
â”‚
â””â”€â”€ .kiro/specs/user-authentication/    # åŠŸèƒ½è§„æ ¼æ–‡æ¡£
```

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ¦‚è¿°
- [å®æ–½è¿›åº¦æ€»ç»“-æœ€æ–°.md](å®æ–½è¿›åº¦æ€»ç»“-æœ€æ–°.md) - å½“å‰è¿›åº¦
- [Idrop.in-äº‘é›†-è¯¦ç»†å®æ–½è®¡åˆ’.md](Idrop.in-äº‘é›†-è¯¦ç»†å®æ–½è®¡åˆ’.md) - å®Œæ•´è®¡åˆ’
- [.kiro/specs/user-authentication/](.kiro/specs/user-authentication/) - ç”¨æˆ·è®¤è¯è§„æ ¼

---

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€
